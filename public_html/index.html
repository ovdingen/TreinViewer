<html>

<head>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.2.0/dist/leaflet.css" integrity="sha512-M2wvCLH6DSRazYeZRIm1JnYyh22purTM+FDB5CsyxtQJYeKq83arPe5wgbNmcFXGqiSH2XR8dT/fJISVA1r/zQ==" crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.2.0/dist/leaflet.js" integrity="sha512-lInM/apFSqyy1o6s89K4iQUKg6ppXEgsVxT35HbzUupEVRh2Eu9Wdl4tHj7dZO0s1uvplcYGmt3498TtHq+log==" crossorigin=""></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="js/leaflet-realtime.dist.js"></script>
    <style>
        html, body, #map {
                margin: 0;
                width: 100%;
                height: 100%;
            }
    </style>
</head>

<body onload="">
    <div id="map" class="map"></div>
    <script type="text/javascript">
        var geojsonMarkerOptions = {
            'standaard': {
                radius: 8,
                fillColor: "#ff7800",
                color: "#000",
                weight: 1,
                opacity: 1,
                fillOpacity: 0.8
            },
            'groene': {
                radius: 8,
                fillColor: "#00ff00",
                color: "#000",
                weight: 1,
                opacity: 1,
                fillOpacity: 0.8
            }
        };
        var map = L.map('map', {
            center: [52.228936, 5.321492],
            zoom: 13
        });
        var osmUrl = 'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png';
        var osmAttrib = 'Map data Â© <a href="http://openstreetmap.org">OpenStreetMap</a> contributors';
        var osm = new L.TileLayer(osmUrl, {
            minZoom: 8,
            maxZoom: 12,
            attribution: osmAttrib
        });
        map.addLayer(osm);
        realtime = L.realtime({

            url: './positions.geojson',
            type: 'json',
        }, {
            onEachFeature: function(f, l) {
                l.bindPopup(f.properties.popupContent);
            },
            pointToLayer(feature, latlng) {
                if (feature.properties.materieelnummer[0] == "9556") {
                    return L.circleMarker(latlng, geojsonMarkerOptions.groene);
                }

                return L.circleMarker(latlng, geojsonMarkerOptions.standaard);
            },
            interval: 3 * 1000
        }).addTo(map);


        /*  var evtSource = new EventSource('estest.php');  

          evtSource.onmessage = function(e) {
            if(e.data == "UPDATE") {
              console.log("Received update message from eventSource, updating...");
              updateTreintjes();
            } else {
              console.log("Vreemd eventsource bericht ontvangen: ");
              console.log(e.data);
            }
          }*/

          // Locatie opvragen van gebruiker
          map.locate({setView: true, maxZoom: 16});

          function onLocationFound(e) {
              var radius = e.accuracy / 2;

              L.marker(e.latlng).addTo(map)
                  .bindPopup("Volgens je browser ben je momenteel hier.<br><i>Deze locatie kan door verschillende<br>factoren niet kloppen.<br>Onze excuses voor het ongemak.</i>");

              L.circle(e.latlng, radius).addTo(map);
          }

          map.on('locationfound', onLocationFound);
    </script>

    <script src="js/fullscreen.js"></script>
</body>

</html>
